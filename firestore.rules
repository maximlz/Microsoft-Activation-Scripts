rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Функция для проверки, является ли пользователь администратором
    function isAdmin() {
      return request.auth != null && request.auth.token.email_verified && request.auth.token.email.matches('.*@artbutton\\.com$');
    }

    // Коллекция стран (countries)
    match /countries/{countryId} {
      // Разрешаем чтение всем (если это нужно для основной формы)
      allow read: if true;
      // Запись/удаление/обновление разрешаем только администраторам
      allow write, delete, update: if isAdmin();
    }

    // Коллекция регистраций гостей (guests)
    match /guests/{guestId} {
      // Создание (addDoc из GuestForm) разрешаем всем (или только аутентифицированным?)
      // Если форма доступна неавторизованным пользователям, оставляем true.
      // Если вход нужен даже для заполнения формы, можно поставить: if request.auth != null;
      allow create: if true;
      // Чтение, обновление, удаление разрешаем только администраторам
      allow read, update, delete: if isAdmin();
    }

    // Другие коллекции (если есть)
    // match /otherCollection/{docId} {
    //   allow read, write: if isAdmin();
    // }
  }
} 